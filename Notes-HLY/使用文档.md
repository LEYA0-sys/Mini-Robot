# 服务器

## IP：1.13.92.135

## 密码：Sztu@xiaozhi

## 用户名：ubuntu

# 服务端代码部分

## 开启api、server、web并使用

```
systemctl stop mysql
docker start xiaozhi-esp32-server-redis
docker start xiaozhi-esp32-server-db
# 在这里使用docker ps，需要看到 xiaozhi-esp32-server-redis 和 xiaozhi-esp32-server-db
cd /home/ubuntu/prjs/xiaozhi-esp32-server/main/manager-api
screen -L -Logfile ~/manager_api.log -dmS manager_api mvn spring-boot:run
cd /home/ubuntu/prjs/xiaozhi-esp32-server/main/manager-web
screen -L -Logfile ~/manager_web.log -dmS manager_web npm run serve
cd /home/ubuntu/prjs/xiaozhi-esp32-server/main/xiaozhi-server
conda activate xiaozhi-esp32-server
screen -L -Logfile ~/xiaozhi_server.log -dmS xiaozhi_server python app.py 
```

> [!CAUTION]
>
> 当执行上述操作以后小智异常，可能是以下几个原因
>
> 端口被占用、docker容器没有开启、screen没有开启
>
> 如果发现小智异常，需要重启服务端

```
# 查看服务是否开启
#查看 manager-api 日志：

  screen -r manager_api

#查看 manager-web 日志：

  screen -r manager_web

#查看 xiaozhi-server 日志：

  screen -r xiaozhi_server
```

![image-20250903230405372](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/image-20250903230405372-1756911846417-14.png)



## ASR语音

```
独立部署FunASR，使用FunASR的API服务，只需要五句话

第一句：mkdir -p ./funasr-runtime-resources/models

第二句：sudo docker run -p 10096:10095 -it --privileged=true -v $PWD/funasr-runtime-resources/models:/workspace/models registry.cn-hangzhou.aliyuncs.com/funasr_repo/funasr:funasr-runtime-sdk-online-cpu-0.1.12

上一句话执行后会进入到容器，继续第三句：cd FunASR/runtime

不要退出容器，继续在容器中执行第四句：nohup bash run_server_2pass.sh --download-model-dir /workspace/models --vad-dir damo/speech_fsmn_vad_zh-cn-16k-common-onnx --model-dir damo/speech_paraformer-large-vad-punc_asr_nat-zh-cn-16k-common-vocab8404-onnx  --online-model-dir damo/speech_paraformer-large_asr_nat-zh-cn-16k-common-vocab8404-online-onnx  --punc-dir damo/punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727-onnx --lm-dir damo/speech_ngram_lm_zh-cn-ai-wesp-fst --itn-dir thuduj12/fst_itn_zh --hotword /workspace/models/hotwords.txt > log.txt 2>&1 &

上一句话执行后会进入到容器，继续第五句：tail -f log.txt

第五句话执行完后，会看到模型下载日志，下载完后就可以连接使用了
```

# 腾讯云

### 把业务、审计、事件日志投递至COS桶，文件夹分别定义为yewu/audit/shijian

# 注册操作

### 在注册界面进行注册，填写集群IP、腾讯云的密钥和id

![image-20250903185131094](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/image-20250903185131094-1756896692058-1.png)

![image-20250903185121790](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/image-20250903185121790.png)

# 登录操作

## 使用以下账号使用我们的小智机器人

## ![image-20250903223820365](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/image-20250903223820365-1756910302365-1.png)

## 对小智说几句话，然后点击这里录入声纹

![ba304b4e-0000-4a93-b249-81e150cfb5a8](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/ba304b4e-0000-4a93-b249-81e150cfb5a8-1756910390875-4.png)

![cd4f9f7d-567c-4776-b613-30763a41e322](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/cd4f9f7d-567c-4776-b613-30763a41e322-1756910519879-7.png)

## 添加刚才说的话

## ![image-20250903224231916](./%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3.assets/image-20250903224231916-1756910552899-9.png)

# 配置告警策略

## 在腾讯云平台把告警发送的接口设定为 http://1.13.92.135:8003/webhook/alert/rag

# MCP服务

```
cd /home/ubuntu/prjs/xiaozhi-esp32-server/mcp-calculator
export MCP_ENDPOINT=ws://1.13.92.135:8004/mcp_endpoint/mcp/?token=%2BXq8leptRRs4ljHl87hrEGXDBVlTnTvuyVsJMsq%2BvtLmXMd7jvjv0ovCiB9WVX6T
python mcp_pipe.py calculator.py
```



