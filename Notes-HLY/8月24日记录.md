å¥½çš„ âœ… é‚£æˆ‘ä¸ºä½ å†™äº†ä¸€ä¸ª **å¿«é€Ÿæ“ä½œæŒ‡å—**ï¼ŒåŒ…å«æ¯ä¸€æ­¥çš„æ“ä½œï¼Œæ–¹ä¾¿ä½ æŒ‰ç…§é¡ºåºæ‰§è¡Œå®éªŒå¹¶è§¦å‘ä¸åŒçš„å›æ»šç­–ç•¥ã€‚

------

## ğŸš€ å¿«é€Ÿæ“ä½œæŒ‡å—ï¼šæ¼”ç»ƒ MCP å›æ»šå·¥å…·

### 1. **å‡†å¤‡ç¯å¢ƒ**

é¦–å…ˆï¼Œå°† **å®Œæ•´çš„ YAML æ–‡ä»¶** éƒ¨ç½²åˆ°é›†ç¾¤é‡Œï¼š

```bash
kubectl apply -f rollback-lab.yaml
```

è¿™ä¸ªå‘½ä»¤ä¼šéƒ¨ç½²ï¼š

- **Nginx Web æœåŠ¡**
- **MySQL StatefulSet**
- **Sysbench å‹æµ‹ Pod**
- **NetworkPolicy**ï¼ˆé™åˆ¶ MySQL è®¿é—®ï¼Œç”¨æ¥æ¨¡æ‹Ÿç½‘ç»œå¼‚å¸¸ï¼‰

### 2. **è§¦å‘å›æ»šç­–ç•¥ï¼š**

#### âš¡ **æ¨¡æ‹Ÿ CPU å’Œå†…å­˜è¿‡è½½**

1. ç¡®ä¿ **Sysbench Pod** æ­£åœ¨è¿è¡Œï¼Œåˆ©ç”¨ **sysbench** å¯¹ MySQL è¿›è¡Œå‹æµ‹ï¼š

   ```bash
   kubectl logs sysbench-client
   ```

2. è§‚å¯Ÿåˆ°é«˜ CPU å’Œå†…å­˜æ¶ˆè€—æ—¶ï¼Œå¯èƒ½ä¼šè§¦å‘ä»¥ä¸‹å›æ»šï¼š

   - `rollback_cpu_high_usage`
   - `rollback_memory_high_usage`

#### âš¡ **æ¨¡æ‹Ÿ Pod CrashLoop**

1. ä¿®æ”¹ **Nginx** éƒ¨ç½²ï¼Œæ•…æ„å°† `livenessProbe` çš„ `path` æ”¹ä¸ºé”™è¯¯çš„è·¯å¾„ï¼š

   ```yaml
   livenessProbe:
     httpGet:
       path: /wrong-path   # è§¦å‘ CrashLoop
   ```

2. æ›´æ–° Nginx éƒ¨ç½²ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

3. è§‚å¯Ÿ Nginx Pod ä¼šä¸æ–­é‡å¯ï¼Œè§¦å‘ï¼š

   - `rollback_pod_crash_loop`

#### âš¡ **æ¨¡æ‹ŸæœåŠ¡ä¸å¯ç”¨**

1. ä¿®æ”¹ **Nginx** éƒ¨ç½²ï¼Œæ•…æ„å°† `readinessProbe` çš„ `path` æ”¹ä¸ºé”™è¯¯çš„è·¯å¾„ï¼š

   ```yaml
   readinessProbe:
     httpGet:
       path: /wrong-path   # è§¦å‘æœåŠ¡ä¸å¯ç”¨
   ```

2. æ›´æ–° Nginx éƒ¨ç½²ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

3. è§‚å¯Ÿåˆ° Nginx æœåŠ¡ä¸å¯ç”¨ï¼Œè§¦å‘ï¼š

   - `rollback_service_unavailable`

#### âš¡ **æ¨¡æ‹Ÿé•œåƒæ‹‰å–å¤±è´¥**

1. ä¿®æ”¹ **Nginx** æˆ– **MySQL** éƒ¨ç½²ï¼Œæ”¹ä¸ºé”™è¯¯çš„é•œåƒï¼š

   ```yaml
   image: nginx:fake123  # é”™è¯¯é•œåƒ
   ```

2. æ›´æ–°éƒ¨ç½²ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

3. è§‚å¯Ÿåˆ° Pod å¯åŠ¨å¤±è´¥ï¼Œè§¦å‘ï¼š

   - `rollback_image_pull_failed`

#### âš¡ **æ¨¡æ‹Ÿå­˜å‚¨é—®é¢˜**

1. ä¿®æ”¹ **MySQL** éƒ¨ç½²ï¼Œæ”¹ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„ `storageClassName`ï¼š

   ```yaml
   storageClassName: invalid-storage-class  # æ”¹é”™å­˜å‚¨ç±»
   ```

2. æ›´æ–° MySQL éƒ¨ç½²ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

3. è§‚å¯Ÿåˆ° MySQL Pod å¡åœ¨ `Pending` çŠ¶æ€ï¼Œè§¦å‘ï¼š

   - `rollback_storage_issues`

#### âš¡ **æ¨¡æ‹Ÿç½‘ç»œé—®é¢˜**

1. éƒ¨ç½²åï¼Œé»˜è®¤ MySQL Pod æ˜¯å¯è®¿é—®çš„ã€‚æˆ‘ä»¬é€šè¿‡ **NetworkPolicy** ç¦æ­¢è®¿é—® MySQL æœåŠ¡ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

2. ç„¶åç”¨ **Sysbench** è®¿é—® MySQLï¼Œä¼šå¤±è´¥ï¼Œè§¦å‘ï¼š

   - `rollback_network_issues`

3. å¦‚æœä½ æƒ³æ¢å¤ç½‘ç»œè®¿é—®ï¼Œå¯ä»¥åˆ é™¤ `NetworkPolicy`ï¼š

   ```bash
   kubectl delete networkpolicy deny-mysql-access
   ```

------

### 3. **æ¢å¤æ“ä½œ**

#### âš¡ **æ¢å¤ç½‘ç»œ**

1. åˆ é™¤ `NetworkPolicy`ï¼Œæ¢å¤ MySQL è®¿é—®ï¼š

   ```bash
   kubectl delete networkpolicy deny-mysql-access
   ```

#### âš¡ **æ¢å¤æœåŠ¡**

1. æ¢å¤ Nginx æœåŠ¡çš„å¥åº·æ£€æŸ¥é…ç½®ï¼Œä¿®æ”¹ `livenessProbe` å’Œ `readinessProbe`ï¼Œé‡æ–°åº”ç”¨ï¼š

   ```bash
   kubectl apply -f rollback-lab.yaml
   ```

#### âš¡ **æ¢å¤èµ„æºé…ç½®**

1. æ¢å¤èµ„æºè¯·æ±‚ä¸é™åˆ¶ï¼Œé¿å…è¿‡è½½ï¼š

   ```yaml
   resources:
     requests:
       cpu: "100m"
       memory: "256Mi"
     limits:
       cpu: "500m"
       memory: "512Mi"
   ```

### 4. **æ¸…ç†å®éªŒç¯å¢ƒ**

å½“ä½ å®Œæˆå®éªŒåï¼Œè®°å¾—æ¸…ç†ç¯å¢ƒï¼š

```bash
kubectl delete -f rollback-lab.yaml
```

------

## ğŸ“Š è§¦å‘å›æ»šæ€»ç»“ï¼š

- **CPU/Mem è¿‡è½½**ï¼šä½¿ç”¨ Sysbench å‹æµ‹è§¦å‘
- **Pod CrashLoop**ï¼šä¿®æ”¹ `livenessProbe` é”™è¯¯è·¯å¾„
- **æœåŠ¡ä¸å¯ç”¨**ï¼šä¿®æ”¹ `readinessProbe` é”™è¯¯è·¯å¾„
- **é•œåƒæ‹‰å–å¤±è´¥**ï¼šä½¿ç”¨é”™è¯¯é•œåƒå
- **å­˜å‚¨é—®é¢˜**ï¼šé…ç½®ä¸å­˜åœ¨çš„ `storageClassName`
- **ç½‘ç»œé—®é¢˜**ï¼šé€šè¿‡ `NetworkPolicy` ç¦æ­¢è®¿é—® MySQL

------

é€šè¿‡è¿™ä¸ªå®éªŒï¼Œä½ å¯ä»¥å…¨é¢æ¼”ç»ƒ **MCP å›æ»šå·¥å…·**ï¼ŒéªŒè¯å…¶å¯¹ä¸åŒæ•…éšœåœºæ™¯çš„è‡ªåŠ¨æ¢å¤èƒ½åŠ›ã€‚

æœ‰å…¶ä»–æƒ³è¦æ·»åŠ çš„å®éªŒæˆ–ä¿®æ”¹çš„åœ°æ–¹å—ï¼Ÿ