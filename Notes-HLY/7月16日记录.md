# 集群部署

### 前言

本来考虑的是wedata数据治理平台，但是这个实在是太贵了，一个月费用高达7000，没有必要。下面是性价比比较高的几个应用，主要有两类，一类是常规的应用，另一类是比较创新的。目前的方案是我先部署好常规应用，先把机器人提升到能够播报常规应用的日志级别再来播报创新型应用的日志。

---

## **📌 推荐方案（常规应用）**
### **1. 部署 Nginx（最简单的 Web 服务）**
**用途**：产生 HTTP 访问日志、Pod 运行状态  
**适用场景**：最基础的测试，适合快速验证集群是否正常  

#### **📌 部署步骤**
```bash
# 1. 直接运行 Nginx Deployment
kubectl create deployment nginx --image=nginx:latest

# 2. 暴露 Service（ClusterIP 模式）
kubectl expose deployment nginx --port=80

# 3. 改成 LoadBalancer（如果想从外网访问）
kubectl patch svc nginx -p '{"spec":{"type":"LoadBalancer"}}'

# 4. 查看访问地址（等待 EXTERNAL-IP 分配）
kubectl get svc nginx
```
**✅ 效果**：
- 集群里会有 `nginx-xxxx` Pod 运行
- 访问 `http://<EXTERNAL-IP>` 会看到 Nginx 欢迎页
- 查看日志：`kubectl logs -f <nginx-pod-name>`

---

### **2. 部署 Redis（内存数据库，适合模拟任务队列）**
**用途**：产生内存、CPU 使用数据，适合测试监控  
**适用场景**：模拟任务队列、缓存服务  

#### **📌 部署步骤**
```bash
# 1. 运行 Redis
kubectl create deployment redis --image=redis:alpine

# 2. 暴露 Service
kubectl expose deployment redis --port=6379

# 3. 进入 Redis CLI 测试
kubectl exec -it <redis-pod-name> -- redis-cli
```
**✅ 效果**：
- 集群里会有 `redis-xxxx` Pod
- 可以用 `kubectl top pod` 查看 CPU/内存使用情况
- 适合测试 Prometheus 监控

---

### **3. 部署一个 Python Flask 应用（模拟业务日志）**
**用途**：自定义日志输出，模拟真实业务  
**适用场景**：测试日志采集、监控告警  

#### **📌 部署步骤**
```bash
# 1. 创建一个 flask-app.yaml
cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: flask-app
  template:
    metadata:
      labels:
        app: flask-app
    spec:
      containers:
      - name: flask
        image: python:3.9-slim
        command: ["sh", "-c"]
        args:
          - pip install flask && echo 'from flask import Flask; app = Flask(__name__); @app.route("/"); def hello(): return "Hello, TKE!"; app.run(host="0.0.0.0", port=5000)' > app.py && python app.py
        ports:
        - containerPort: 5000
EOF

# 2. 暴露 Service
kubectl expose deployment flask-app --port=5000 --type=LoadBalancer

# 3. 查看访问地址
kubectl get svc flask-app
```
**✅ 效果**：
- 访问 `http://<EXTERNAL-IP>:5000` 会返回 `Hello, TKE!`
- 查看日志：`kubectl logs -f <flask-pod-name>`
- 适合测试 **日志采集 + Prometheus 监控**

---

## **📊 检测哪些集群状态？**
| 检测目标            | 适用工具                                   | 用途                           |
| ------------------- | ------------------------------------------ | ------------------------------ |
| **Pod 运行状态**    | `kubectl get pods`                         | 检查 Pod 是否 CrashLoopBackOff |
| **CPU/内存使用**    | `kubectl top pods`                         | 监控资源占用                   |
| **HTTP 访问日志**   | `kubectl logs`                             | 分析 Nginx/Flask 日志          |
| **网络连通性**      | `kubectl exec -it <pod> -- curl <service>` | 测试 Service 是否正常          |
| **Prometheus 指标** | `kubectl port-forward svc/prometheus 9090` | 查看监控数据                   |

---

## **🚀 总结**
### **📌 推荐部署顺序**
1. **先跑 Nginx**（最快，5 分钟搞定）
2. **再加 Redis**（测试资源监控）
3. **最后 Flask**（模拟业务日志）

### **📌 后续优化**
- 如果想 **长期监控**，可以加 **Prometheus + Grafana**
- 如果想 **分析日志**，可以加 **ELK（Elasticsearch + Fluentd + Kibana）**
- 如果想 **模拟真实业务**，可以跑 **MySQL + 微服务**

🎯

# 📌 推荐方案2（创新型应用）



如果你想在 **腾讯云 TKE 集群** 里部署一些 **特别**、**有趣**，又能让 **领导眼前一亮** 的应用，可以考虑以下几种 **创新性、可视化、互动性强** 的方案，既能展示技术能力，又能让集群有丰富的日志和监控数据供机器人检测：

---

## **🎯 1. 部署一个实时数据可视化大屏（Grafana + Prometheus + 酷炫 Dashboard）**
**亮点**：  
✅ **领导最爱看的数据大屏**，实时展示集群状态、业务指标  
✅ 结合 **Prometheus 监控**，自动采集 CPU/内存/网络等数据  
✅ 支持 **自定义业务指标**（如用户访问量、API 调用次数）  

### **📌 部署步骤**
```bash
# 1. 安装 Prometheus（监控数据采集）
helm install prometheus prometheus-community/prometheus

# 2. 安装 Grafana（可视化）
helm install grafana grafana/grafana

# 3. 获取 Grafana 登录密码
kubectl get secret grafana -o jsonpath="{.data.admin-password}" | base64 --decode

# 4. 配置数据源（Prometheus）并导入酷炫 Dashboard（如 ID 315）
```
**📊 效果**：
- 访问 `http://<Grafana-Service-IP>:3000`，展示 **实时集群监控大屏**  
- 可以自定义 **业务 KPI 看板**，让领导看到你的技术前瞻性  

---

## **🚀 2. 部署一个 AI 聊天机器人（GPT-3.5/LLM + FastAPI）**
**亮点**：  
✅ **AI 交互**，让领导体验“智能问答”  
✅ 可对接 **企业内部知识库**（如公司制度、产品手册）  
✅ 自动生成 **运维报告**（如集群健康状态）  

### **📌 部署步骤**
```bash
# 1. 创建 chatbot.yaml
cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: chatbot
spec:
  replicas: 1
  selector:
    matchLabels:
      app: chatbot
  template:
    metadata:
      labels:
        app: chatbot
    spec:
      containers:
      - name: chatbot
        image: python:3.9
        command: ["sh", "-c"]
        args:
          - pip install fastapi uvicorn openai && echo 'from fastapi import FastAPI; import openai; app = FastAPI(); @app.get("/ask"); def ask(q: str): return openai.ChatCompletion.create(model="gpt-3.5-turbo", messages=[{"role": "user", "content": q}])' > app.py && uvicorn app:app --host 0.0.0.0 --port 8000
        ports:
        - containerPort: 8000
EOF

# 2. 暴露 Service（LoadBalancer）
kubectl expose deployment chatbot --port=8000 --type=LoadBalancer

# 3. 测试 AI 聊天
curl "http://<EXTERNAL-IP>:8000/ask?q=如何优化K8s集群？"
```
**🤖 效果**：
- 访问 `http://<EXTERNAL-IP>:8000/docs` 可交互式提问  
- 可扩展对接 **企业内部数据**，让领导觉得“技术很前沿”  

---

## **🌐 3. 部署一个区块链浏览器（Ethereum/Hyperledger 数据可视化）**
**亮点**：  
✅ **区块链+云原生**，技术栈新颖  
✅ 实时展示 **交易数据、区块高度**  
✅ 可对接 **腾讯云区块链服务（TBaaS）**  

### **📌 部署步骤**
```bash
# 1. 部署 Ethereum 全节点（轻量模式）
helm install ethereum \
  --set resources.requests.cpu=1 \
  --set resources.requests.memory=2Gi \
  ethereum/client-go

# 2. 部署区块链浏览器（如 Etherscan 开源版）
kubectl apply -f https://raw.githubusercontent.com/gobitfly/etherchain-light/master/k8s/deployment.yaml
```
**🔗 效果**：
- 访问 `http://<Blockchain-Explorer-IP>`，展示 **实时链上数据**  
- 可结合 **腾讯云 TBaaS**，让领导看到 **云原生+区块链** 的落地案例  

---

## **🤖 4. 部署一个 Kubernetes 集群“自愈”演示（Chaos Mesh 混沌工程）**
**亮点**：  
✅ **自动故障注入+自愈**，展示 **云原生高可用能力**  
✅ 模拟 **Pod 崩溃、网络延迟、节点宕机**  
✅ 结合 **Prometheus 告警**，让领导看到 **智能运维**  

### **📌 部署步骤**
```bash
# 1. 安装 Chaos Mesh（混沌工程工具）
helm install chaos-mesh chaos-mesh/chaos-mesh --namespace=chaos-testing --create-namespace

# 2. 注入一个 Pod 故障（自动恢复）
kubectl apply -f - <<EOF
apiVersion: chaos-mesh.org/v1alpha1
kind: PodChaos
metadata:
  name: pod-kill-demo
spec:
  action: pod-kill
  mode: one
  selector:
    labelSelector:
      "app": "nginx"
  scheduler:
    cron: "@every 2m"
EOF
```
**⚡ 效果**：
- 每 2 分钟 **随机杀掉一个 Nginx Pod**，K8s 会自动重建  
- 结合 **Grafana** 展示 **自愈过程**，让领导觉得“技术很稳”  

---

## **📌 5. 部署一个“智能运维机器人”（Slack/Discord Bot + K8s API）**
**亮点**：  
✅ **聊天机器人 + K8s 运维**，炫酷又实用  
✅ 支持 **查询 Pod 状态、扩缩容、查看日志**  
✅ 可扩展 **自动故障修复**（如自动重启 CrashLoopBackOff Pod）  

### **📌 部署步骤**
```bash
# 1. 创建 bot.yaml
cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: k8s-bot
spec:
  replicas: 1
  selector:
    matchLabels:
      app: k8s-bot
  template:
    metadata:
      labels:
        app: k8s-bot
    spec:
      containers:
      - name: bot
        image: python:3.9
        command: ["sh", "-c"]
        args:
          - pip install slackbot kubernetes && echo 'from slackbot import Bot; from kubernetes import client; Bot().run()' > bot.py && python bot.py
EOF
```
**🤖 效果**：
- 在 **Slack/Discord** 输入 `/k8s get pods`，机器人返回 **集群状态**  
- 可扩展 **自动告警+修复**，让领导觉得“运维自动化程度高”  

---

## **🎯 总结：哪个最让领导眼前一亮？**
| 方案              | 亮点                 | 适用场景       |
| ----------------- | -------------------- | -------------- |
| **Grafana 大屏**  | 数据可视化，领导最爱 | 汇报、监控展示 |
| **AI 聊天机器人** | 智能问答，技术前瞻   | 内部知识管理   |
| **区块链浏览器**  | 区块链+云原生结合    | 金融、政务场景 |
| **混沌工程自愈**  | 高可用演示           | 技术实力展示   |
| **智能运维 Bot**  | 聊天式运维           | 自动化运维     |

### **📌 推荐选择**
1. **如果想炫技** → **AI 聊天机器人** 或 **区块链浏览器**  
2. **如果想实用** → **Grafana 大屏** 或 **智能运维 Bot**  
3. **如果想展示稳定性** → **混沌工程自愈演示**  

这些方案都能让你的 **TKE 集群“活”起来**，不再是一个空集群，而是 **有数据、有交互、有智能** 的云原生 playground！ 🚀



# 日志采集

## 步骤

### 1.进入容器服务的控制台

[集群 - 容器服务 - 控制台](https://console.cloud.tencent.com/tke2)

![image-20250715224033047](./7%E6%9C%8816%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250715224033047-1752590434101-6.png)

### 2.打开日志方式之一

![0aed1c14-2ff7-4220-9cae-8e0b583244e4](./7%E6%9C%8816%E6%97%A5%E8%AE%B0%E5%BD%95.assets/0aed1c14-2ff7-4220-9cae-8e0b583244e4-1752590536915-9.png)

![8917a548-05dd-4af0-b9af-31047995fe7c](./7%E6%9C%8816%E6%97%A5%E8%AE%B0%E5%BD%95.assets/8917a548-05dd-4af0-b9af-31047995fe7c-1752590576088-12.png)

### 3.打开日志方式之二

#### 打开日志服务的控制台

[检索分析 - 日志服务 - 控制台](https://console.cloud.tencent.com/cls)



![ec6ab1e8-4572-412c-b4b0-059292f41df6](./7%E6%9C%8816%E6%97%A5%E8%AE%B0%E5%BD%95.assets/ec6ab1e8-4572-412c-b4b0-059292f41df6-1752590921125-15-1752590924227-17.png)

![d51b2a0d3f615b72b336ff35116438de](./7%E6%9C%8816%E6%97%A5%E8%AE%B0%E5%BD%95.assets/d51b2a0d3f615b72b336ff35116438de-1752591000269-20.png)

## 部署的应用

TKE的小智集群中已经部署了挺多应用了，其中有一些日志内容较多如csi-cbs-controller，其中有一些日志内容较少如coredns。