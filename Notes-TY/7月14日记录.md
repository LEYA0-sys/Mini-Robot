# å›¾åƒè¯†åˆ«

## 1.äººè„¸è¯†åˆ«å®ç°åŸç†

1. **ç³»ç»Ÿæ¶æ„**ï¼š
   - ä½¿ç”¨AppFaceç±»ä½œä¸ºä¸»è¦å®ç°ç±»ï¼Œé‡‡ç”¨è§‚å¯Ÿè€…æ¨¡å¼ä¸å…¶ä»–ç»„ä»¶ï¼ˆæŒ‰é”®ã€è¯­éŸ³ã€ç›¸æœºã€æ˜¾ç¤ºï¼‰äº¤äº’
   - é‡‡ç”¨åŸºäºé˜Ÿåˆ—çš„å›¾åƒæ•°æ®æµå¤„ç†æ–¹å¼ï¼Œå¤šä¸ªç»„ä»¶é—´é€šè¿‡é˜Ÿåˆ—ä¼ é€’æ•°æ®
2. **äººè„¸æ£€æµ‹**ï¼š
   - ä½¿ç”¨ä¸¤çº§æ£€æµ‹å™¨ï¼šHumanFaceDetectMSR01ï¼ˆä¸»æ£€æµ‹å™¨ï¼‰å’ŒHumanFaceDetectMNP01ï¼ˆç»†åŒ–æ£€æµ‹å™¨ï¼‰
   - MSR01è´Ÿè´£åˆæ­¥æ£€æµ‹å¯èƒ½çš„äººè„¸åŒºåŸŸï¼Œç”Ÿæˆå€™é€‰æ¡†
   - MNP01å¯¹å€™é€‰æ¡†è¿›è¡ŒäºŒæ¬¡ç­›é€‰ï¼Œæé«˜å‡†ç¡®æ€§
3. **äººè„¸è¯†åˆ«æµç¨‹**ï¼š
   - å›¾åƒè·å–ï¼šä»ç›¸æœºè·å–RGB565æ ¼å¼çš„å›¾åƒå¸§
   - äººè„¸æ£€æµ‹ï¼šä½¿ç”¨ä¸¤çº§æ£€æµ‹å™¨æ£€æµ‹äººè„¸ä½ç½®å’Œå…³é”®ç‚¹
   - äººè„¸å¯¹é½ï¼šåŸºäºå…³é”®ç‚¹å¯¹äººè„¸è¿›è¡Œå¯¹é½ï¼ˆalign_faceå‡½æ•°ï¼‰
   - ç‰¹å¾æå–ï¼šä½¿ç”¨FaceRecognition112V1S8/S16æ¨¡å‹æå–äººè„¸ç‰¹å¾å‘é‡
   - ç‰¹å¾åŒ¹é…ï¼šè®¡ç®—ç‰¹å¾å‘é‡ä¸å·²æ³¨å†Œäººè„¸çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œåˆ¤æ–­èº«ä»½
4. **æ“ä½œæ¨¡å¼**ï¼š
   - äººè„¸æ³¨å†Œï¼ˆFACE_ENROLLï¼‰ï¼šæ³¨å†Œæ–°çš„äººè„¸IDåˆ°ç³»ç»Ÿ
   - äººè„¸è¯†åˆ«ï¼ˆFACE_RECOGNIZEï¼‰ï¼šè¯†åˆ«å½“å‰äººè„¸å¹¶åŒ¹é…å·²æ³¨å†ŒID
   - åˆ é™¤äººè„¸ï¼ˆFACE_DELETEï¼‰ï¼šåˆ é™¤å·²æ³¨å†Œçš„äººè„¸ID
   - ç©ºé—²çŠ¶æ€ï¼ˆFACE_IDLEï¼‰ï¼šç³»ç»Ÿä¸æ‰§è¡Œç‰¹å®šäººè„¸æ“ä½œ
5. **æ¨¡å‹ä¸ç®—æ³•**ï¼š
   - ä½¿ç”¨è½»é‡çº§ç¥ç»ç½‘ç»œè¿›è¡Œäººè„¸æ£€æµ‹ä¸ç‰¹å¾æå–
   - ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆcosine similarityï¼‰è¿›è¡Œç‰¹å¾åŒ¹é…
   - æ”¯æŒä¸¤ç§ç²¾åº¦æ¨¡å¼ï¼šS8ï¼ˆ8ä½é‡åŒ–ï¼‰å’ŒS16ï¼ˆ16ä½é‡åŒ–ï¼‰
   - ç›¸ä¼¼åº¦é˜ˆå€¼æ§åˆ¶ï¼ˆé»˜è®¤0.98ï¼‰ï¼šé«˜äºæ­¤å€¼è§†ä¸ºåŒä¸€äºº
6. **æ•°æ®å­˜å‚¨**ï¼š
   - äººè„¸ç‰¹å¾å‘é‡å­˜å‚¨åœ¨ESP32çš„Flashåˆ†åŒºä¸­ï¼ˆåä¸º"fr"çš„åˆ†åŒºï¼‰
   - æ”¯æŒäººè„¸IDçš„æŒä¹…åŒ–å­˜å‚¨å’ŒåŠ è½½

æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨èµ„æºå—é™çš„ESP32å¹³å°ä¸Šå®ç°è½»é‡çº§ä½†åŠŸèƒ½å®Œæ•´çš„äººè„¸è¯†åˆ«ç³»ç»Ÿï¼Œæ•´åˆäº†è§†è§‰ã€è¯­éŸ³å’ŒæŒ‰é”®äº¤äº’ï¼Œæä¾›äº†æ³¨å†Œã€è¯†åˆ«å’Œç®¡ç†äººè„¸çš„å®Œæ•´åŠŸèƒ½ã€‚



è¿™ä¸ªäººè„¸è¯†åˆ«ç³»ç»Ÿæ˜¯**å®Œå…¨åœ¨ESP32æœ¬åœ°å®ç°**çš„ï¼Œæ²¡æœ‰ä½¿ç”¨æœåŠ¡å™¨ç«¯AIã€‚

1. æ•´ä¸ªè¯†åˆ«æµç¨‹éƒ½åœ¨ESP32è®¾å¤‡ä¸Šæ‰§è¡Œï¼ŒåŒ…æ‹¬ï¼š
   - äººè„¸æ£€æµ‹ï¼ˆä½¿ç”¨HumanFaceDetectMSR01å’ŒHumanFaceDetectMNP01æœ¬åœ°æ¨¡å‹ï¼‰
   - äººè„¸ç‰¹å¾æå–ï¼ˆä½¿ç”¨FaceRecognition112V1S8/S16æœ¬åœ°æ¨¡å‹ï¼‰
   - äººè„¸åŒ¹é…ï¼ˆæœ¬åœ°è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰

2. äººè„¸ç‰¹å¾æ•°æ®å­˜å‚¨åœ¨ESP32è‡ªèº«çš„Flashåˆ†åŒºä¸­ï¼ˆ"fr"åˆ†åŒºï¼‰

3. ä»£ç ä¸­æ²¡æœ‰ä»»ä½•ç½‘ç»œé€šä¿¡ã€HTTPè¯·æ±‚æˆ–äº‘æœåŠ¡APIè°ƒç”¨

è¿™æ˜¯ESP32-S3ç­‰AIèŠ¯ç‰‡çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œå¯ä»¥åœ¨èµ„æºå—é™çš„åµŒå…¥å¼è®¾å¤‡ä¸Šæœ¬åœ°è¿è¡Œè½»é‡çº§ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œæ— éœ€ä¾èµ–äº‘æœåŠ¡ï¼Œå®ç°å®Œå…¨ç¦»çº¿çš„AIåŠŸèƒ½ã€‚



## 2.YOLOå®ç°åŸç†

è¿™ä¸ªYOLOæ¼”ç¤ºç¨‹åºæ˜¯ä¸€ä¸ªå®Œå…¨åœ¨ESP32æœ¬åœ°æ‰§è¡Œçš„ç›®æ ‡æ£€æµ‹ç³»ç»Ÿï¼Œä¸éœ€è¦æœåŠ¡å™¨ç«¯AIæ”¯æŒã€‚è¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†YOLOv11næ¨¡å‹ï¼Œä¸€ä¸ªä¸ºESP32èŠ¯ç‰‡ä¼˜åŒ–çš„è½»é‡çº§ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œæ”¯æŒè¯†åˆ«COCOæ•°æ®é›†ä¸­çš„80ç§å¸¸è§ç‰©ä½“ï¼ˆå¦‚äººã€è½¦ã€åŠ¨ç‰©ç­‰ï¼‰ã€‚

å…³é”®ç‰¹ç‚¹ï¼š

1. **å®Œå…¨æœ¬åœ°æ¨ç†**ï¼š
   - æ‰€æœ‰æ¨¡å‹æ¨ç†å®Œå…¨åœ¨ESP32èŠ¯ç‰‡ä¸Šæ‰§è¡Œï¼Œæ— éœ€ç½‘ç»œè¿æ¥
   - æ¨¡å‹å¯ä»¥å­˜å‚¨åœ¨Flashä¸­ï¼ˆrodataæˆ–ä¸“ç”¨åˆ†åŒºï¼‰æˆ–SDå¡ä¸Š

2. **ä¼˜åŒ–çš„æ¨¡å‹**ï¼š
   - ä½¿ç”¨YOLOv11nï¼ˆYOLOçš„è½»é‡çº§ç‰ˆæœ¬ï¼‰ï¼Œç»è¿‡é‡åŒ–ä¼˜åŒ–é€‚é…ESP32èµ„æºé™åˆ¶
   - æä¾›å¤šç§æ¨¡å‹å˜ä½“ï¼ˆV1/V2/V3ï¼‰å’Œä¸åŒè¾“å…¥å°ºå¯¸ï¼ˆ320x320æˆ–640x640ï¼‰
   - æ ¹æ®READMEæ˜¾ç¤ºï¼Œæ¨¡å‹å¤§å°ä¸º8-16MBï¼Œåœ¨ESP32-S3ä¸Šè¿è¡Œæ—¶é—´ä¸ºå‡ ç§’åˆ°æ•°åç§’

3. **é‡åŒ–æŠ€æœ¯**ï¼š
   - ä½¿ç”¨8ä½é‡åŒ–ï¼ˆS8ï¼‰é™ä½å†…å­˜éœ€æ±‚
   - æ”¯æŒæ··åˆç²¾åº¦é‡åŒ–å’Œé‡åŒ–æ„ŸçŸ¥è®­ç»ƒç­‰ä¼˜åŒ–æŠ€æœ¯

4. **å·¥ä½œæµç¨‹**ï¼š
   - ä»æ‘„åƒå¤´è·å–å›¾åƒ
   - é¢„å¤„ç†å›¾åƒï¼ˆç¼©æ”¾ã€å½’ä¸€åŒ–ï¼‰
   - é€šè¿‡YOLOv11næ¨¡å‹è¿›è¡Œæ¨ç†
   - åå¤„ç†æ£€æµ‹ç»“æœï¼ˆè¿‡æ»¤ä½ç½®ä¿¡åº¦æ¡†ã€åº”ç”¨NMSç­‰ï¼‰
   - åœ¨æ˜¾ç¤ºå±ä¸Šæ¸²æŸ“ç»“æœï¼ˆæ ‡æ³¨æ£€æµ‹æ¡†å’Œç±»åˆ«åç§°ï¼‰

5. **æ¨¡å¼æ§åˆ¶**ï¼š
   - é€šè¿‡æŒ‰é’®åˆ‡æ¢æ‘„åƒå¤´æ˜¾ç¤ºæ¨¡å¼å’ŒAIæ£€æµ‹æ¨¡å¼
   - é•¿æŒ‰æŒ‰é’®å¯ä»¥å¼ºåˆ¶è¿”å›æ‘„åƒå¤´æ¨¡å¼ï¼ˆç´§æ€¥é‡ç½®ï¼‰

ä¸ä¹‹å‰çš„äººè„¸è¯†åˆ«ç¤ºä¾‹ç±»ä¼¼ï¼Œè¿™ä¸ªYOLOæ¼”ç¤ºæ˜¯å±•ç¤ºESP32èŠ¯ç‰‡åœ¨èµ„æºå—é™ç¯å¢ƒä¸‹æ‰§è¡Œå¤æ‚AIä»»åŠ¡çš„èƒ½åŠ›ï¼Œå®Œå…¨ä¸ä¾èµ–äºäº‘æœåŠ¡æˆ–æœåŠ¡å™¨ç«¯å¤„ç†ã€‚



## 3.æ‘„åƒå¤´å›¾ç‰‡æ•°æ®

`camera_fb_t *frame = esp_camera_fb_get();` è¿™ä¸€è¡Œä»£ç å°±æ˜¯è·å–ç›¸æœºå›¾åƒæ•°æ®çš„æ ¸å¿ƒæ“ä½œã€‚`esp_camera_fb_get()`å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘`camera_fb_t`ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä½“åŒ…å«äº†å®Œæ•´çš„ç›¸æœºå¸§ç¼“å†²åŒºã€‚

`camera_fb_t`æ˜¯ESP32ç›¸æœºé©±åŠ¨ä¸­å®šä¹‰çš„å¸§ç¼“å†²åŒºç»“æ„ä½“ï¼Œå®ƒåŒ…å«ä»¥ä¸‹æˆå‘˜ï¼š

```c
typedef struct {
    uint8_t * buf;              // æŒ‡å‘å›¾åƒæ•°æ®çš„æŒ‡é’ˆ
    size_t len;                 // å›¾åƒæ•°æ®çš„é•¿åº¦(å­—èŠ‚æ•°)
    size_t width;               // å›¾åƒå®½åº¦(åƒç´ )
    size_t height;              // å›¾åƒé«˜åº¦(åƒç´ )
    pixformat_t format;         // åƒç´ æ ¼å¼(ä¾‹å¦‚PIXFORMAT_RGB565, PIXFORMAT_JPEGç­‰)
    struct timeval timestamp;   // å¸§æ•è·çš„æ—¶é—´æˆ³
} camera_fb_t;
```

åœ¨äººè„¸è¯†åˆ«ç¤ºä¾‹ä¸­ï¼š

1. `buf`å­—æ®µæŒ‡å‘RGB565æ ¼å¼çš„å›¾åƒæ•°æ®(æ¯ä¸ªåƒç´ ç”¨2å­—èŠ‚è¡¨ç¤º)
2. å›¾åƒå°ºå¯¸ä¸º240x240åƒç´ (è¿™æ˜¯åœ¨app_main.cppä¸­è®¾ç½®çš„)
3. æ•°æ®æ€»å¤§å°çº¦ä¸º115KB(240x240x2å­—èŠ‚)

è¿™ä¸ªç»“æ„ä½“æä¾›äº†è®¿é—®åŸå§‹å›¾åƒæ•°æ®æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯:

- ä½ å¯ä»¥é€šè¿‡`frame->buf`è®¿é—®åŸå§‹çš„RGB565åƒç´ æ•°æ®
- é€šè¿‡`frame->width`å’Œ`frame->height`è·å–å›¾åƒå°ºå¯¸
- é€šè¿‡`frame->format`ç¡®è®¤åƒç´ æ ¼å¼(RGB565ã€JPEGç­‰)

ä½¿ç”¨å®Œå›¾åƒæ•°æ®åï¼Œåº”å½“è°ƒç”¨`esp_camera_fb_return(frame)`å½’è¿˜è¿™ä¸ªå¸§ç¼“å†²åŒºï¼Œæˆ–è€…å¦‚æœä½ è‡ªå·±å¤„ç†å†…å­˜ï¼Œåˆ™ä½¿ç”¨`free(frame)`é‡Šæ”¾å®ƒã€‚



## 4.RGB565

RGB565 æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºæ•°å­—å›¾åƒé¢œè‰²çš„**16ä½ï¼ˆ2å­—èŠ‚ï¼‰è‰²å½©ç¼–ç æ ¼å¼**ï¼Œå¹¿æ³›åº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€æ˜¾ç¤ºå±é©±åŠ¨å’Œå›¾åƒå¤„ç†ä¸­ï¼ˆå°¤å…¶åœ¨èµ„æºå—é™çš„è®¾å¤‡ï¼‰ã€‚å…¶æ ¸å¿ƒè®¾è®¡æ˜¯åœ¨æœ‰é™çš„å­˜å‚¨ç©ºé—´å†…å¹³è¡¡è‰²å½©è´¨é‡å’Œå†…å­˜å ç”¨ã€‚

---

###  ä¸€ã€æ ¼å¼ç»“æ„è§£æ

RGB565 å°†æ¯ä¸ªåƒç´ çš„é¢œè‰²åˆ†è§£ä¸º**çº¢ï¼ˆRï¼‰ã€ç»¿ï¼ˆGï¼‰ã€è“ï¼ˆBï¼‰** ä¸‰ä¸ªé€šé“ï¼Œå¹¶æŒ‰ä»¥ä¸‹ä½å®½åˆ†é…ï¼š

```
| 15        11 | 10         5 | 4          0 |
|--------------|--------------|--------------|
|   Red (5ä½)  | Green (6ä½)  |  Blue (5ä½)  |
```

- **çº¢è‰²ï¼ˆRï¼‰**ï¼šå ç”¨ **5ä½**ï¼ˆå–å€¼èŒƒå›´ `0~31`ï¼‰  
- **ç»¿è‰²ï¼ˆGï¼‰**ï¼šå ç”¨ **6ä½**ï¼ˆå–å€¼èŒƒå›´ `0~63`ï¼‰  
- **è“è‰²ï¼ˆBï¼‰**ï¼šå ç”¨ **5ä½**ï¼ˆå–å€¼èŒƒå›´ `0~31`ï¼‰  

> ğŸ“Œ **ä¸ºä»€ä¹ˆç»¿è‰²å¤š1ä½ï¼Ÿ**  
> äººçœ¼å¯¹ç»¿è‰²æ›´æ•æ„Ÿï¼Œå¢åŠ ç»¿è‰²åˆ†è¾¨ç‡å¯æå‡è§†è§‰æ„ŸçŸ¥çš„è‡ªç„¶åº¦ã€‚

---

###  äºŒã€å¼€å‘ä¸­çš„æ“ä½œ

#### 1. **åƒç´ è¯»å†™ï¼ˆCè¯­è¨€ç¤ºä¾‹ï¼‰**

```c
// å°†RGBå€¼æ‰“åŒ…ä¸ºRGB565æ ¼å¼
uint16_t rgb565 = ((r & 0x1F) << 11) | ((g & 0x3F) << 5) | (b & 0x1F);

// ä»RGB565è§£æé¢œè‰²
uint8_t r = (rgb565 >> 11) & 0x1F;  // æå–é«˜5ä½
uint8_t g = (rgb565 >> 5)  & 0x3F;  // æå–ä¸­é—´6ä½
uint8_t b = rgb565 & 0x1F;           // æå–ä½5ä½
```

---

###  æ€»ç»“

RGB565 æ˜¯åµŒå…¥å¼é¢†åŸŸçš„**é«˜æ•ˆè‰²å½©å¦¥åæ–¹æ¡ˆ**ï¼š  
âœ… **ä¼˜åŠ¿**ï¼šèŠ‚çœ33~50%å†…å­˜/å¸¦å®½ï¼Œæ»¡è¶³å¤šæ•°åœºæ™¯çš„è‰²å½©éœ€æ±‚ã€‚  
âŒ **åŠ£åŠ¿**ï¼šä¸é€‚åˆæ‘„å½±çº§å›¾åƒå¤„ç†ã€‚  
åœ¨ESP32ç­‰ç‰©è”ç½‘è®¾å¤‡ä¸­ï¼Œå®ƒæ˜¯æ‘„åƒå¤´é‡‡é›†ã€LCDæ˜¾ç¤ºçš„é¦–é€‰æ ¼å¼ï¼Œç›´æ¥å½±å“ç³»ç»Ÿæ€§èƒ½ä¸åŠŸè€—ã€‚



# WSL+VScodeçš„espç¯å¢ƒå¼€å‘

https://blog.csdn.net/m0_67862631/article/details/148105239?fromshare=blogdetail&sharetype=blogdetail&sharerId=148105239&sharerefer=PC&sharesource=2302_80024781&sharefrom=from_link

https://blog.csdn.net/m0_67862631/article/details/148118009?fromshare=blogdetail&sharetype=blogdetail&sharerId=148118009&sharerefer=PC&sharesource=2302_80024781&sharefrom=from_link

å…·ä½“æ­¥éª¤å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« 

æ“ä½œå®Œä¹‹åé€Ÿåº¦èµ·é£ï¼Œè¿˜èƒ½ç”¨**VScodeå›¾å½¢åŒ–ç¼–è¯‘çƒ§å½•**





![image-20250714141743608](./7%E6%9C%8814%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250714141743608.png)

![image-20250714142413844](./7%E6%9C%8814%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250714142413844.png)





ç”¨5.4.1çš„IDFè¿è¡Œå‡ºç°é—®é¢˜ï¼ŒI2Cé©±åŠ¨å†²çª

ä¹‹åä½¿ç”¨5.3.3ä¹Ÿæœ‰è¿™æ ·çš„é—®é¢˜

åŒæ—¶æˆ‘ç›´æ¥çƒ§å½•å•†å®¶ç»™çš„å›ºä»¶ä¹Ÿæœ‰é—®é¢˜

![image-20250714181239895](./7%E6%9C%8814%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250714181239895.png)

![img](./7%E6%9C%8814%E6%97%A5%E8%AE%B0%E5%BD%95.assets/O1CN01NdcR3e1XdmHOODQfp_!!2218551232947-2-ampmedia.png)

å•†å®¶è¯´åªæœ‰è¿™ä¸‰ä¸ªå›ºä»¶æ˜¯èƒ½ç”¨çš„





åœ¨taskä¸­æŒç»­æ‰“å°è¿™ä¸ªæ•°æ®å¤ªå¤šäº†ï¼Œespç›´æ¥ä¸€ç›´é‡å¯ï¼Œä¸”è¿™ä¸ªæ•°æ®é‡å¾ˆå¤§ï¼Œæˆ‘æ‹¿åˆ°æ ¼å¼æ•°æ®å°±å¥½äº†



çƒ§å½•ä¹‹åæ²¡æ¥ç”±çš„æ— æ³•å”¤é†’ï¼Œåªèƒ½è¯†åˆ«ç¬¬ä¸€æ¬¡ï¼Œä¼¼ä¹æ˜¯éº¦å…‹é£çš„åŸå› ã€‚åé¢å¥½ä¸€ç‚¹äº†



ä¸€è¯´äººè„¸è¯†åˆ«ï¼Œä»–å°±é‡å¯ã€‚å‡†å¤‡æŠŠesp IDFçš„ç‰ˆæœ¬é™çº§äº†ï¼Œå¯èƒ½ä¸æ˜¯è¿™ä¸ªåŸå› 



