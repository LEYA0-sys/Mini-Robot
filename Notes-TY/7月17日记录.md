# 7月17日记录

## 1.网页图像数据

![image-20250717004757871](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717004757871.png)

这个以 `blob:http://192.168.4.1/...` 开头的字符串是一个 **Blob URL (或 Object URL)**。它是在 **浏览器环境** 中，通过 JavaScript API (`URL.createObjectURL()`) 动态创建的一个**临时 URL**，用于引用浏览器内存中或本地生成的 **Blob 对象** 或 **File 对象**。



**总结 `blob:http://192.168.4.1/025e6dcb-35d4-47ef-b66e-673a2cf31e13`：**

- 它是由运行在 `http://192.168.4.1` 这个（很可能是本地的）网页应用上的 JavaScript 代码动态创建的。
- 它指向一个存储在**你当前浏览器内存中**的二进制数据块（Blob），这个数据块可能来自你选择的本地文件，也可能是该网页应用动态生成的。
- 这个 URL 的主要目的是让该网页应用**能在不将数据上传到真正服务器的情况下**，在你的浏览器内部**预览、播放或处理**这些数据（例如显示你刚选择的图片）。
- 这个 URL 是**临时的、私有的**，只在你当前访问的这个页面中有效。离开页面或关闭标签，它就失效了。你无法在浏览器外部或另一个标签页直接使用它访问到原始数据。

**如果你在某个网页上看到这样的 URL（比如图片显示的是这种地址），说明该网页正在使用这个机制来处理本地文件或动态数据。**



## 2.获取数据流程

1.原本想直接用网页控制台直接拿这个JPEG原始的二进制数据，但对前端不熟悉，一直拿不到

2.之后直接让小智在串口打印出来这个JPEG二进制数据，但是数据量太大，小智一打印就直接重启了。并且发现小智在打印大量数据时会发出电流声（滋滋滋的声音）

3.让其转化为JPEG数据之后，慢慢打印出来。当然这个时候，传出的图像也很慢，需要等打印完才传出一帧数据![image-20250717135101016](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717135101016.png)

4.监视得到数据![image-20250717135234612](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717135234612.png)



## 3.JPEG二进制数据的使用

要将你手中的 RGB565 转 JPEG 的二进制数据还原成可视图片，你**不需要原始 RGB565 的参数**，因为 JPEG 是一种自包含的压缩格式。以下是关键信息和操作步骤：

------

### 🛠️ 所需的核心参数/组件：

1. **JPEG 二进制数据本身**
   - 这是你已拥有的核心数据（通常是 `.jpg` 或 `.jpeg` 文件的原始字节流）。
2. **JPEG 解码器**
   - 用于解析二进制数据并还原为像素矩阵（如 Python 的 Pillow、OpenCV；C/C++ 的 libjpeg；JavaScript 的 Canvas 等）。

> ⚠️ 注意：**JPEG 头信息已包含图像尺寸**（宽度/高度），因此无需额外提供！



### 📌 技术说明：

| 参数                | 是否必需 | 说明                                                     |
| :------------------ | :------- | :------------------------------------------------------- |
| **JPEG 二进制数据** | ✅ 必需   | 包含完整的图像压缩数据和元信息（尺寸、色彩空间等）       |
| 图像宽度/高度       | ❌ 无需   | 从 JPEG 文件头自动解析                                   |
| RGB565 位深         | ❌ 无需   | JPEG 已解码为标准 RGB/YUV 格式，原始位深信息在压缩后丢失 |
| 色彩空间            | ❌ 无需   | JPEG 默认为 YCbCr，解码器自动转为 RGB                    |



- 确保二进制数据以 JPEG 标准头 `FF D8 FF` 开始，以 `FF D9` 结束。





## 4.解决gitee仓库中小智固件的问题

### 1.摄像头图像翻转

![image-20250717202902507](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717202902507.png)

修改宏定义 BSP_CAMERA_VFLIP

### 2.一说人脸识别就会崩溃重启

#### 日志报错

```
Guru Meditation Error: Core  1 panic'ed (LoadProhibited). Exception was unhandled.

Core  1 register dump:
PC      : 0x4200a61c  PS      : 0x00060430  A0      : 0x8037fee8  A1      : 0x3fcdc050  
--- 0x4200a61c: task(AppFace*) at /home/esp/esp32/esp_sparkbot/example/human_face_recognition_no_wakenet/main/src/app_face.cpp:223

A2      : 0x3fcb83c4  A3      : 0x3c2e2130  A4      : 0x3fcb8444  A5      : 0x3c2e2098  
A6      : 0x00000001  A7      : 0x00000000  A8      : 0x8200a61c  A9      : 0x3fcdc030  
A10     : 0xffffffe0  A11     : 0x3fcba654  A12     : 0x0000000c  A13     : 0x3fcb8444  
A14     : 0x3fcb9cdc  A15     : 0x3fcab9b0  SAR     : 0x0000001d  EXCCAUSE: 0x0000001c  
EXCVADDR: 0xffffffe0  LBEG    : 0x40054bf0  LEND    : 0x40054c0f  LCOUNT  : 0x00000000  
--- 0x40054bf0: __divdf3 in ROM
--- 0x40054c0f: __divdf3 in ROM



Backtrace: 0x4200a619:0x3fcdc050 0x4037fee5:0x3fcdc170
--- 0x4200a619: task(AppFace*) at /home/esp/esp32/esp_sparkbot/example/human_face_recognition_no_wakenet/main/src/app_face.cpp:223
--- 0x4037fee5: vPortTaskWrapper at /home/esp/esp32/esp-idf/components/freertos/FreeRTOS-Kernel/portable/xtensa/port.c:139
```

​    

#### 报错代码

```
      case FACE_ENROLL:

          rgb_printf(frame, RGB565_MASK_BLUE, "Enroll: ID %d", self->recognizer->get_enrolled_ids().back().id);

           break;
```



但找不到解决办法

### 3.另外一家店铺

[烧录固件网站](https://esp.jziai.com/)

在这个烧录网站中的Face_jzi固件，有时能用有时重启
![image-20250717215612575](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717215612575.png)

![image-20250717215658630](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717215658630.png)

![image-20250717215720663](./7%E6%9C%8817%E6%97%A5%E8%AE%B0%E5%BD%95.assets/image-20250717215720663.png)

### 问题诊断

1. **音频缓冲区溢出 (W AFE_SR)**

   ```
   W (45061) AFE_SR: Ringbuffer of AFE is full
   ```

   - 音频前端(AFE)数据产生速度 > 处理速度
   - 根本原因：人脸识别任务(App/face)阻塞了语音处理任务(App/SN/feed)

2. **任务看门狗超时 (E task_wdc)**

   ```
   E (50061) task_wdc: Task watchdog got triggered
   E (50061) task_wdc: CPU 1: App/face
   ```

   - `App/face`任务在CPU1上运行超过看门狗超时时间（默认5秒）
   - 表明人脸识别任务执行时间过长
